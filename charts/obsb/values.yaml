# ============================================================
# Global
# ============================================================

global:
  clusterName: "obsb-dev"
  storageClass: "standard"   # Your Kind default SC (NOT local-path)

# ============================================================
# ZABBIX CONFIG
# ============================================================

zabbix:
  enabled: true

  server:
    replicaCount: 1
    env:
      DB_SERVER_HOST: "obsb-postgresql"
      DB_SERVER_PORT: "5432"
      POSTGRES_USER: "zabbix"
      POSTGRES_PASSWORD: "zabbix"
      POSTGRES_DB: "zabbix"

  frontend:
    service:
      type: ClusterIP
    env:
      DB_SERVER_HOST: "obsb-postgresql"
      DB_SERVER_PORT: "5432"
      POSTGRES_USER: "zabbix"
      POSTGRES_PASSWORD: "zabbix"
      POSTGRES_DB: "zabbix"

  proxy:
    enabled: true

  database:
    type: postgresql

  # âœ” REAL OVERRIDE PATH for PostgreSQL (inside Zabbix chart)
  postgresql:
    enabled: true

    image:
      registry: docker.io
      repository: bitnami/postgresql
      tag: "15.6.0-debian-12-r7"
      pullPolicy: IfNotPresent

    auth:
      username: zabbix
      password: zabbix
      database: zabbix

    primary:
      persistence:
        enabled: true
        storageClass: "standard"
        size: 1Gi


# ============================================================
# OPENSEARCH
# ============================================================

opensearch:
  enabled: true

  replicas: 1
  clusterName: "obsb-opensearch"

  sysctlInit:
    enabled: false

  persistence:
    enabled: true
    size: 5Gi
    storageClass: "standard"

  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi

  roles:
    - master
    - ingest
    - data

  opensearchJavaOpts: "-Xms512m -Xmx512m"


# ============================================================
# OPENSEARCH DASHBOARDS
# ============================================================

dashboards:
  enabled: true

  replicaCount: 1
  opensearchHosts: "http://obsb-opensearch:9200"

  service:
    type: ClusterIP

  resources:
    requests:
      cpu: 100m
      memory: 256Mi


# ============================================================
# LOGSTASH (with correct OpenSearch plugin)
# ============================================================

logstash:
  enabled: true

  image: "opensearchproject/logstash-oss-with-opensearch-output-plugin"
  imageTag: "7.16.3"
  imagePullPolicy: "IfNotPresent"

  replicaCount: 1

  logstashPipeline:
    logstash.conf: |
      input {
        beats {
          port => 5044
        }
      }
      output {
        opensearch {
          hosts => ["http://obsb-opensearch:9200"]
          index => "logs-%{+YYYY.MM.dd}"
        }
      }

  service:
    type: ClusterIP
    ports:
      - name: beats
        port: 5044
        targetPort: 5044


# ============================================================
# TRIVY SCANNER
# ============================================================

trivy:
  enabled: true

  image: "aquasec/trivy:latest"

  imageScanning:
    enabled: true
    schedule: "0 */6 * * *"
    imageList:
      - "nginx:latest"
      - "python:3.11-slim"
    outputDir: /results

  k8sScanning:
    enabled: true
    schedule: "0 2 * * *"
    namespaces:
      - default
      - obsb-core
    outputDir: /results


# ============================================================
# LOGGING (Fluent Bit / logshipper)
# ============================================================

logging:
  enabled: true


# ============================================================
# STACKS (EXAMPLE COMMENTED)
# ============================================================

# stacks:
#   - name: "example-app"
#     namespace: "default"
#     logs:
#       enabled: true
#     metrics:
#       enabled: true
#     security:
#       enabled: true

stacks: []


# ============================================================
# INGRESS
# ============================================================

ingress:
  enabled: false
  className: "nginx"

  dashboards:
    host: dashboards.local
    path: /

  zabbix:
    host: zabbix.local
    path: /
